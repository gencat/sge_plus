<% add_decidim_page_title(t("info", scope: "decidim.admin.menu.candidacies_submenu")) %>
<% add_decidim_page_title(translated_attribute(current_participatory_space.title)) %>
<div class="item_show__header">
  <h1 class="item_show__header-title">
    <%= t("info", scope: "decidim.admin.menu.candidacies_submenu") %>
  </h1>
</div>

<div class="item__edit item__edit-1col">
  <div class="item__edit-form">
    <%= decidim_form_for @form, html: { class: "form-defaults form edit_candidacy" } do |f| %>
      <%= render partial: "form", object: f %>
      <div class="item__edit-sticky">
        <div class="item__edit-sticky-container">
          <%= f.submit t(".update"), class: "button button__sm button__secondary" if allowed_to? :update, :candidacy, candidacy: current_candidacy %>

            <% if allowed_to? :send_to_technical_validation, :candidacy, candidacy: current_candidacy %>
              <%= link_to t(".send_to_technical_validation"),
                          send_to_technical_validation_candidacy_path(current_candidacy),
                          class: "button button__sm button__secondary",
                          data: { confirm: t(".confirm_send_to_technical_validation") } %>
            <% elsif current_candidacy.created? %>
              <%= link_to t(".send_to_technical_validation"), "#", class: "button button__sm button__secondary" %>
            <% end %>

            <% if allowed_to? :publish, :candidacy, candidacy: current_candidacy %>
              <%= link_to t("actions.publish", scope: "decidim.admin"),
                          publish_candidacy_path(current_candidacy),
                          method: :post,
                          class: "button button__sm button__secondary",
                          data: { confirm: t(".confirm") } %>
            <% end %>

            <% if allowed_to? :unpublish, :candidacy, candidacy: current_candidacy %>
              <%= link_to t("actions.unpublish", scope: "decidim.admin"),
                          unpublish_candidacy_path(current_candidacy),
                          method: :delete,
                          class: "button button__sm button__secondary",
                          data: { confirm: t(".confirm") } %>
            <% end %>

            <% if allowed_to? :accept, :candidacy, candidacy: current_candidacy %>
                <%= link_to t(".accept"),
                            accept_candidacy_path(current_candidacy),
                            method: :post,
                            class: "button button__sm button__secondary",
                            data: { confirm: t(".confirm") } %>
            <% end %>

            <% if allowed_to? :reject, :candidacy, candidacy: current_candidacy %>
                <%= link_to t(".reject"),
                            reject_candidacy_path(current_candidacy),
                            method: :delete,
                            class: "button button__sm button__secondary",
                            data: { confirm: t(".confirm") } %>
            <% end %>

            <% if allowed_to? :discard, :candidacy, candidacy: current_candidacy %>
              <%= link_to t(".discard"),
                          discard_candidacy_path(current_candidacy),
                          method: :delete,
                          class: "button button__sm button__secondary",
                          data: { confirm: t(".confirm") } %>
            <% end %>

            <% if allowed_to? :export_votes, :candidacy, candidacy: current_candidacy %>
              <%= link_to t(".export_votes"),
                          export_votes_candidacy_path(current_candidacy, format: :csv),
                          class: "button button__sm button__secondary",
                          data: { confirm: t(".confirm") } %>
            <% end %>

            <% if allowed_to? :export_pdf_signatures, :candidacy, candidacy: current_candidacy %>
              <%= link_to t(".export_pdf_signatures"),
                          export_pdf_signatures_candidacy_path(current_candidacy, format: :pdf),
                          class: "button button__sm button__secondary" %>
            <% end %>
       </div>
     </div>
    <% end %>
  </div>
</div>
